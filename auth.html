<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Sales Coach AI</title>
    <link rel="stylesheet" href="css/styles.css">
    
    <!-- Supabase Config -->
    <script>
      window.SUPABASE_URL = "https://vrauyvcwmgqlbqrnkngx.supabase.co";
      window.SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZyYXV5dmN3bWdxbGJxcm5rbmd4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUwMTY5NTgsImV4cCI6MjA4MDU5Mjk1OH0.5RwraVx_nOWFrVfrT851q8SL475DuTvJS6Mep1GK8Rk";
    </script>
</head>
<body>
    <div class="login-container">
        <div class="login-box">
            <h1>ðŸ¤– Sales Coach AI</h1>
            <p>IngresÃ¡ para continuar</p>
            
            <div id="login-form">
                <input type="email" id="email" placeholder="Email" required>
                <input type="password" id="password" placeholder="Password" required>
                <button id="login-btn">Ingresar</button>
                <p class="switch-mode">
                    Â¿No tenÃ©s cuenta? <a href="#" id="show-signup">Crear cuenta</a>
                </p>
            </div>
            
            <div id="signup-form" style="display:none;">
                <input type="email" id="signup-email" placeholder="Email" required>
                <input type="password" id="signup-password" placeholder="Password (mÃ­n 6 caracteres)" required>
                <button id="signup-btn">Crear cuenta</button>
                <p class="switch-mode">
                    Â¿Ya tenÃ©s cuenta? <a href="#" id="show-login">Ingresar</a>
                </p>
            </div>
            
            <div id="error-msg" class="error" style="display:none;"></div>
        </div>
    </div>
    
    <script>
         // Cargar Supabase desde UMD bundle
        const script = document.createElement('script');
	script.src = 'https://unpkg.com/@supabase/supabase-js@2.39.0/dist/umd/supabase.js';
        script.onload = initLogin;
        document.head.appendChild(script);
        
        let supabase;
        
        function initLogin() {
            const createClient = window.supabase.createClient;
            
            supabase = createClient(
                window.SUPABASE_URL,
                window.SUPABASE_ANON_KEY
            );
            
            const loginForm = document.getElementById('login-form');
            const signupForm = document.getElementById('signup-form');
            const errorMsg = document.getElementById('error-msg');
            
            // Switch entre login y signup
            document.getElementById('show-signup').addEventListener('click', (e) => {
                e.preventDefault();
                loginForm.style.display = 'none';
                signupForm.style.display = 'block';
                errorMsg.style.display = 'none';
            });
            
            document.getElementById('show-login').addEventListener('click', (e) => {
                e.preventDefault();
                signupForm.style.display = 'none';
                loginForm.style.display = 'block';
                errorMsg.style.display = 'none';
            });
            
            // Login
            document.getElementById('login-btn').addEventListener('click', async () => {
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;
                
                if (!email || !password) {
                    showError('Por favor completa email y password');
                    return;
                }
                
                const { data, error } = await supabase.auth.signInWithPassword({
                    email,
                    password
                });
                
                if (error) {
                    showError(error.message);
                } else {
                    window.location.href = '/';
                }
            });
            
            // Signup
            document.getElementById('signup-btn').addEventListener('click', async () => {
                const email = document.getElementById('signup-email').value;
                const password = document.getElementById('signup-password').value;
                
                if (!email || !password) {
                    showError('Por favor completa email y password');
                    return;
                }
                
                if (password.length < 6) {
                    showError('Password debe tener al menos 6 caracteres');
                    return;
                }
                
                const { data, error } = await supabase.auth.signUp({
                    email,
                    password
                });
                
                if (error) {
                    showError(error.message);
                } else {
                    showError('Cuenta creada! Chequea tu email para confirmar.', false);
                    setTimeout(() => {
                        signupForm.style.display = 'none';
                        loginForm.style.display = 'block';
                    }, 2000);
                }
            });
            
            function showError(msg, isError = true) {
                errorMsg.textContent = msg;
                errorMsg.style.display = 'block';
                errorMsg.className = isError ? 'error' : 'success';
            }
            
            // Check if already logged in
            supabase.auth.getUser().then(({ data: { user } }) => {
                if (user) {
                    window.location.href = '/';
                }
            });
        }
    </script>
</body>
</html>
