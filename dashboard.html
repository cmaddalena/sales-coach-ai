<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - Sales Coach AI</title>
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>

  <!-- Header -->
  <header class="dashboard-header">
    <div class="logo">ü§ñ Sales Coach AI</div>
    <div class="user-menu">
      <span id="user-name">Usuario</span>
      <button id="logout-btn" onclick="logout()">Salir</button>
    </div>
  </header>

  <!-- Main Content -->
  <main class="dashboard-main">
    
    <!-- Welcome Card -->
    <div class="welcome-card">
      <h1>Hola <span id="nombre-usuario">Usuario</span>! üëã</h1>
      <p id="tipo-negocio">Sistema comercial completo.</p>
    </div>
    
    <!-- Tabs Navigation -->
    <div class="tabs">
      <button class="tab active" onclick="showTab('overview')">üìä Overview</button>
      <button class="tab" onclick="showTab('coach')">üß† Tu Coach</button>
      <button class="tab" onclick="showTab('leads')">üë• Contactos</button>
      <button class="tab" onclick="showTab('perfil')">‚öôÔ∏è Mi Perfil</button>
    </div>
    
    <!-- TAB: Overview -->
    <div id="tab-overview" class="tab-content active">
      
      <!-- Stats Grid -->
      <div class="stats-grid">
        <div class="stat-card">
          <h3>Objetivo Mes</h3>
          <p class="stat-value" id="objetivo-mensual">$0</p>
        </div>
        
        <div class="stat-card">
          <h3>Revenue Actual</h3>
          <p class="stat-value" id="revenue-actual">$0</p>
        </div>
        
        <div class="stat-card">
          <h3>Tiempo Disponible</h3>
          <p class="stat-value" id="tiempo-disponible">0h/sem</p>
        </div>
        
        <div class="stat-card">
          <h3>Leads Activos</h3>
          <p class="stat-value" id="leads-activos">0</p>
        </div>
      </div>
      
      <!-- Action Cards -->
      <div class="action-cards">
        <div class="action-card">
          <h3>üéØ Pr√≥ximas Acciones</h3>
          <p>Sistema en construcci√≥n...</p>
          <ul>
            <li>Morning Briefing autom√°tico</li>
            <li>Recomendaciones inteligentes</li>
            <li>Tracking leads</li>
            <li>Chat con IA contextual</li>
          </ul>
        </div>
        
        <div class="action-card">
          <h3>üìã Tu Perfil</h3>
          <p><strong>Nombre:</strong> <span id="perfil-nombre">-</span></p>
          <p><strong>Negocio:</strong> <span id="perfil-negocio">-</span></p>
          <p><strong>Pa√≠s:</strong> <span id="perfil-pais">-</span></p>
          <p><strong>Objetivo mensual:</strong> $<span id="perfil-objetivo">-</span></p>
          <p><strong>Tiempo disponible:</strong> <span id="perfil-tiempo">-</span>h/semana</p>
        </div>
      </div>
      
    </div>
    
    <!-- TAB: Coach -->
    <div id="tab-coach" class="tab-content">
      
      <!-- Frase del D√≠a -->
      <div class="coach-motivacion">
        <div class="quote-icon">üí™</div>
        <p id="frase-dia" class="frase">Cargando tu coach personal...</p>
      </div>
      
      <!-- Estado Actual -->
      <div class="coach-estado">
        <h3>üìà Tu momento:</h3>
        
        <div class="estado-grid">
          <div class="estado-item">
            <label>Energ√≠a</label>
            <div class="progress-bar">
              <div id="energia-bar" class="progress-fill" style="width: 0%"></div>
            </div>
            <span id="energia-text">7/10</span>
          </div>
          
          <div class="estado-item">
            <label>Motivaci√≥n</label>
            <div class="progress-bar">
              <div id="motivacion-bar" class="progress-fill" style="width: 0%"></div>
            </div>
            <span id="motivacion-text">7/10</span>
          </div>
          
          <div class="estado-item">
            <label>Progreso mes</label>
            <div class="progress-bar">
              <div id="progreso-bar" class="progress-fill" style="width: 0%"></div>
            </div>
            <span id="progreso-text">0%</span>
          </div>
        </div>
        
        <button onclick="reportarEstado()" class="btn-secondary">
          ¬øC√≥mo te sent√≠s hoy?
        </button>
      </div>
      
      <!-- Situaci√≥n + Plan -->
      <div class="coach-situacion">
        <h3 id="situacion-title">üéØ Analizando situaci√≥n...</h3>
        <p id="situacion-descripcion">Generando recomendaciones...</p>
      </div>
      
      <div class="coach-plan">
        <h3>üí° Qu√© hacer AHORA:</h3>
        <div id="plan-acciones">
          <p>Cargando plan personalizado...</p>
        </div>
      </div>
      
      <!-- Bot√≥n P√°nico -->
      <div class="coach-panico">
        <button onclick="activarModoCoach()" class="btn-panico">
          üÜò Necesito ayuda YA
        </button>
        <p class="panico-hint">Trigger chat IA modo "coach emocional"</p>
      </div>
      
    </div>
    
    <!-- TAB: Leads -->
    <div id="tab-leads" class="tab-content">
      <!-- REPLACE: Tab Leads content (buscar y reemplazar el bloque mock actual) -->
<div id="leads-tab-content" style="padding: 20px;">
  
  <!-- Header con filtros y bot√≥n agregar -->
  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 15px;">
    
    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
      <button onclick="filtrarLeads('todos')" id="filter-todos" class="filter-btn active" style="padding: 8px 16px; border: 2px solid #6366f1; background: #6366f1; color: white; border-radius: 8px; cursor: pointer; font-weight: 600;">
        Todos
      </button>
      <button onclick="filtrarLeads('caliente')" id="filter-caliente" class="filter-btn" style="padding: 8px 16px; border: 2px solid #ef4444; background: white; color: #ef4444; border-radius: 8px; cursor: pointer; font-weight: 600;">
        üî• Calientes
      </button>
      <button onclick="filtrarLeads('tibio')" id="filter-tibio" class="filter-btn" style="padding: 8px 16px; border: 2px solid #f59e0b; background: white; color: #f59e0b; border-radius: 8px; cursor: pointer; font-weight: 600;">
        üå°Ô∏è Tibios
      </button>
      <button onclick="filtrarLeads('frio')" id="filter-frio" class="filter-btn" style="padding: 8px 16px; border: 2px solid #3b82f6; background: white; color: #3b82f6; border-radius: 8px; cursor: pointer; font-weight: 600;">
        ‚ùÑÔ∏è Fr√≠os
      </button>
    </div>
    
    <button onclick="abrirModalAgregarLead()" style="padding: 10px 20px; background: #10b981; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 16px;">
      + Agregar Lead
    </button>
  </div>
  
  <!-- Listado de leads -->
  <div id="leads-list-container" style="background: white; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); padding: 20px; min-height: 300px;">
    <p style="color: #666; text-align: center;">Cargando leads...</p>
  </div>
  
</div>

<!-- Modal para agregar lead -->
<div id="modal-agregar-lead" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
  <div style="background: white; border-radius: 16px; padding: 30px; max-width: 500px; width: 90%; max-height: 90vh; overflow-y: auto;">
    <h2 style="margin-bottom: 20px; color: #333;">Agregar Nuevo Lead</h2>
    
    <form id="form-agregar-lead" onsubmit="guardarNuevoLead(event)" style="display: flex; flex-direction: column; gap: 15px;">
      
      <div>
        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #555;">Nombre *</label>
        <input type="text" id="lead-nombre" required style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px;">
      </div>
      
      <div>
        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #555;">Empresa</label>
        <input type="text" id="lead-empresa" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px;">
      </div>
      
      <div>
        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #555;">Tel√©fono</label>
        <input type="tel" id="lead-telefono" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px;">
      </div>
      
      <div>
        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #555;">Email</label>
        <input type="email" id="lead-email" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px;">
      </div>
      
      <div>
        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #555;">Temperatura *</label>
        <select id="lead-temperatura" required style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px;">
          <option value="caliente">üî• Caliente</option>
          <option value="tibio" selected>üå°Ô∏è Tibio</option>
          <option value="frio">‚ùÑÔ∏è Fr√≠o</option>
        </select>
      </div>
      
      <div>
        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #555;">Tipo</label>
        <select id="lead-tipo" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px;">
          <option value="lead" selected>Lead</option>
          <option value="cliente">Cliente</option>
          <option value="partner">Partner</option>
          <option value="contacto">Contacto</option>
        </select>
      </div>
      
      <div>
        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #555;">Notas</label>
        <textarea id="lead-notas" rows="3" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px; resize: vertical;"></textarea>
      </div>
      
      <div style="display: flex; gap: 10px; margin-top: 10px;">
        <button type="submit" style="flex: 1; padding: 12px; background: #10b981; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 16px;">
          Guardar
        </button>
        <button type="button" onclick="cerrarModalAgregarLead()" style="flex: 1; padding: 12px; background: #ef4444; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 16px;">
          Cancelar
        </button>
      </div>
      
    </form>
  </div>
</div>

<!-- Modal para agregar/editar servicio -->
<div id="modal-servicio" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
  <div style="background: white; border-radius: 16px; padding: 30px; max-width: 600px; width: 90%; max-height: 90vh; overflow-y: auto;">
    <h2 id="modal-servicio-title" style="margin-bottom: 20px; color: #333;">Agregar Servicio</h2>
    
    <form id="form-servicio" onsubmit="guardarServicio(event)" style="display: flex; flex-direction: column; gap: 15px;">
      
      <input type="hidden" id="servicio-id" value="">
      
      <div>
        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #555;">Nombre del Servicio *</label>
        <input type="text" id="servicio-nombre" required placeholder="Ej: Consultor√≠a Comercial" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px;">
      </div>
      
      <div>
        <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #555;">Descripci√≥n</label>
        <textarea id="servicio-descripcion" rows="3" placeholder="Describe qu√© incluye este servicio..." style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px; resize: vertical;"></textarea>
      </div>
      
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
        <div>
          <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #555;">Categor√≠a *</label>
          <select id="servicio-categoria" required style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px;">
            <option value="">Seleccionar...</option>
            <option value="consultor√≠a">Consultor√≠a</option>
            <option value="taller">Taller/Workshop</option>
            <option value="producto">Producto</option>
            <option value="agente_ia">Agente IA</option>
            <option value="implementaci√≥n">Implementaci√≥n</option>
            <option value="otro">Otro</option>
          </select>
        </div>
        
        <div>
          <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #555;">Precio Base ($)</label>
          <input type="number" id="servicio-precio-base" placeholder="1500" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px;">
        </div>
      </div>
      
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
        <div>
          <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #555;">Precio M√≠nimo ($)</label>
          <input type="number" id="servicio-precio-minimo" placeholder="1000" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px;">
        </div>
        
        <div>
          <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #555;">Precio M√°ximo ($)</label>
          <input type="number" id="servicio-precio-maximo" placeholder="2000" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px;">
        </div>
      </div>
      
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
        <div>
          <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #555;">Duraci√≥n</label>
          <input type="text" id="servicio-duracion" placeholder="Ej: 3 meses, 4 horas" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px;">
        </div>
        
        <div>
          <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #555;">Tipo Facturaci√≥n</label>
          <select id="servicio-tipo-facturacion" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px;">
            <option value="">Seleccionar...</option>
            <option value="one-time">Pago √∫nico</option>
            <option value="mensual">Mensual</option>
            <option value="anual">Anual</option>
            <option value="por-proyecto">Por proyecto</option>
          </select>
        </div>
      </div>
      
      <div style="display: flex; gap: 10px; margin-top: 10px;">
        <button type="submit" style="flex: 1; padding: 12px; background: #10b981; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 16px;">
          Guardar
        </button>
        <button type="button" onclick="cerrarModalServicio()" style="flex: 1; padding: 12px; background: #ef4444; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 16px;">
          Cancelar
        </button>
      </div>
      
    </form>
  </div>
</div>

<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f5f5f5; }
  
  .dashboard-header {
    background: white;
    padding: 20px 40px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  }
  
  .logo { font-size: 24px; font-weight: bold; }
  
  .user-menu {
    display: flex;
    align-items: center;
    gap: 20px;
  }
  
  #logout-btn {
    background: #f0f0f0;
    border: none;
    padding: 10px 20px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 14px;
  }
  
  .dashboard-main {
    max-width: 1200px;
    margin: 0 auto;
    padding: 30px 20px;
  }
  
  .welcome-card {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 40px;
    border-radius: 12px;
    margin-bottom: 30px;
  }
  
  .welcome-card h1 { margin-bottom: 10px; }
  
  /* Tabs */
  .tabs {
    display: flex;
    gap: 10px;
    margin-bottom: 30px;
    background: white;
    padding: 10px;
    border-radius: 12px;
  }
  
  .tab {
    flex: 1;
    padding: 15px;
    background: transparent;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 16px;
    font-weight: 600;
    transition: all 0.3s;
  }
  
  .tab:hover { background: #f0f0f0; }
  .tab.active { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
  
  .tab-content { display: none; }
  .tab-content.active { display: block; }
  
  /* Stats Grid */
  .stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
  }
  
  .stat-card {
    background: white;
    padding: 25px;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  }
  
  .stat-card h3 {
    font-size: 14px;
    color: #666;
    margin-bottom: 10px;
  }
  
  .stat-value {
    font-size: 32px;
    font-weight: bold;
    color: #667eea;
  }
  
  /* Action Cards */
  .action-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
  }
  
  .action-card {
    background: white;
    padding: 25px;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  }
  
  .action-card h3 { margin-bottom: 15px; }
  .action-card ul { padding-left: 20px; margin-top: 10px; }
  .action-card li { margin: 8px 0; }
  
  /* Coach Styles */
  .coach-motivacion {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 30px;
    border-radius: 12px;
    margin-bottom: 30px;
    text-align: center;
  }
  
  .quote-icon { font-size: 48px; margin-bottom: 15px; }
  .frase { font-size: 20px; line-height: 1.6; font-style: italic; }
  
  .coach-estado, .coach-situacion, .coach-plan, .coach-panico {
    background: white;
    padding: 25px;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    margin-bottom: 20px;
  }
  
  .estado-grid { display: grid; gap: 20px; margin-bottom: 20px; }
  .estado-item label { display: block; font-size: 14px; color: #666; margin-bottom: 8px; }
  
  .progress-bar {
    width: 100%;
    height: 12px;
    background: #f0f0f0;
    border-radius: 6px;
    overflow: hidden;
    margin-bottom: 5px;
  }
  
  .progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
    transition: width 0.3s ease;
  }
  
  .btn-secondary, .btn-panico {
    padding: 12px 24px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 14px;
    font-weight: 600;
  }
  
  .btn-secondary {
    background: #f0f0f0;
    color: #333;
    width: 100%;
  }
  
  .btn-panico {
    background: #ff4444;
    color: white;
    font-size: 18px;
    padding: 20px 40px;
    box-shadow: 0 4px 12px rgba(255,68,68,0.3);
  }
  
  .coach-panico { text-align: center; padding: 40px 25px; }
  .panico-hint { margin-top: 10px; font-size: 12px; color: #999; }
  
  .coming-soon {
    background: white;
    padding: 60px;
    border-radius: 12px;
    text-align: center;
  }
  
  .coming-soon h2 { margin-bottom: 20px; }
  
  /* ============================================================
     ESTILOS: MI PERFIL
     ============================================================ */

  .perfil-container {
    display: flex;
    gap: 20px;
    min-height: 600px;
  }

  .perfil-sidebar {
    width: 250px;
    background: white;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    flex-shrink: 0;
  }

  .perfil-nav {
    padding: 10px;
  }

  .perfil-nav-item {
    width: 100%;
    text-align: left;
    padding: 15px 20px;
    border: none;
    background: transparent;
    border-radius: 8px;
    cursor: pointer;
    font-size: 16px;
    font-weight: 500;
    color: #666;
    transition: all 0.3s;
    margin-bottom: 5px;
  }

  .perfil-nav-item:hover {
    background: #f5f5f5;
    color: #667eea;
  }

  .perfil-nav-item.active {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
  }

  .perfil-content {
    flex: 1;
    background: white;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    padding: 40px;
    overflow-y: auto;
    max-height: 80vh;
  }

  .perfil-section {
    display: none;
  }

  .perfil-section.active {
    display: block;
  }

  .perfil-card {
    background: #f9f9f9;
    padding: 25px;
    border-radius: 12px;
    margin-bottom: 25px;
    border: 1px solid #e5e5e5;
  }

  .perfil-card h3 {
    margin-bottom: 20px;
    color: #333;
    font-size: 18px;
  }

  .form-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 20px;
  }

  .form-grid label {
    display: block;
    font-size: 14px;
    font-weight: 600;
    color: #555;
    margin-bottom: 8px;
  }

  .form-grid input,
  .form-grid select,
  .form-grid textarea {
    width: 100%;
    padding: 12px;
    border: 2px solid #ddd;
    border-radius: 8px;
    font-size: 16px;
    font-family: inherit;
    transition: border-color 0.3s;
  }

  .form-grid input:focus,
  .form-grid select:focus,
  .form-grid textarea:focus {
    outline: none;
    border-color: #667eea;
  }

  .btn-save {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    padding: 15px 40px;
    border-radius: 8px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    transition: transform 0.3s;
  }

  .btn-save:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(102, 126, 234, 0.4);
  }

  /* ============================================================
     ESTILOS: TABS DE NEGOCIO
     ============================================================ */

    .negocio-tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 30px;
      border-bottom: 2px solid #e5e5e5;
      padding-bottom: 0;
    }

    .negocio-tab-btn {
      padding: 12px 24px;
      border: none;
      background: transparent;
      border-bottom: 3px solid transparent;
      cursor: pointer;
      font-size: 16px;
      font-weight: 600;
      color: #666;
      transition: all 0.3s;
    }

    .negocio-tab-btn:hover {
      color: #667eea;
    }

    .negocio-tab-btn.active {
      color: #667eea;
      border-bottom-color: #667eea;
    }

    .negocio-tab-content {
      display: none;
    }

    .negocio-tab-content.active {
      display: block;
    }

    .servicio-card {
      background: #f9f9f9;
      border: 2px solid #e5e5e5;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 15px;
      transition: all 0.3s;
    }

    .servicio-card:hover {
      border-color: #667eea;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.1);
    }

    .servicio-card.inactive {
      opacity: 0.6;
      background: #f5f5f5;
    }

    .servicio-header {
      display: flex;
      justify-content: space-between;
      align-items: start;
      margin-bottom: 10px;
    }

    .servicio-title {
      font-size: 18px;
      font-weight: 600;
      color: #333;
      margin-bottom: 5px;
    }

    .servicio-categoria {
      display: inline-block;
      padding: 4px 12px;
      background: #667eea;
      color: white;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      margin-left: 10px;
    }

    .servicio-info {
      color: #666;
      font-size: 14px;
      margin-bottom: 8px;
    }

    .servicio-actions {
      display: flex;
      gap: 8px;
    }

    .btn-icon {
      padding: 6px 12px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.3s;
    }

    .btn-edit {
      background: #3b82f6;
      color: white;
    }

    .btn-edit:hover {
      background: #2563eb;
    }

    .btn-toggle {
      background: #f59e0b;
      color: white;
    }

    .btn-toggle:hover {
      background: #d97706;
    }

    .btn-delete {
      background: #ef4444;
      color: white;
    }

    .btn-delete:hover {
      background: #dc2626;
    }

    @media (max-width: 768px) {
      .perfil-container {
        flex-direction: column;
      }
      
      .perfil-sidebar {
        width: 100%;
      }
      
      .perfil-nav {
        display: flex;
        overflow-x: auto;
      }
      
      .perfil-nav-item {
        white-space: nowrap;
      }
      
      .form-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>

  <!-- Scripts -->
  <script>
  // ============================================================
  // INICIALIZACI√ìN Y VARIABLES GLOBALES
  // ============================================================
  let supabase;
  let currentUser = null;
  let userProfile = null;

  // ============================================================
  // FUNCI√ìN: Inicializar Supabase y verificar autenticaci√≥n
  // ============================================================
  async function initDashboard() {
    try {
      // Cargar Supabase
      if (!window.supabase) {
        const script = document.createElement('script');
        script.src = 'https://unpkg.com/@supabase/supabase-js@2.39.0/dist/umd/supabase.js';
        await new Promise(resolve => {
          script.onload = resolve;
          document.head.appendChild(script);
        });
      }
      
      const createClient = window.supabase.createClient;
      supabase = createClient(
        "https://vrauyvcwmgqlbqrnkngx.supabase.co",
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZyYXV5dmN3bWdxbGJxcm5rbmd4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUwMTY5NTgsImV4cCI6MjA4MDU5Mjk1OH0.5RwraVx_nOWFrVfrT851q8SL475DuTvJS6Mep1GK8Rk"
      );
      
      // Verificar si hay usuario logueado
      const { data: { user }, error } = await supabase.auth.getUser();
      
      if (error || !user) {
        console.log('No hay usuario logueado, redirigiendo...');
        window.location.href = '/auth.html';
        return;
      }
      
      currentUser = user;
      localStorage.setItem('userId', user.id);
      
      // Cargar perfil del usuario
      await loadUserProfile(user.id);
      
      // Cargar contenido del dashboard
      loadDashboardContent();
      
    } catch (error) {
      console.error('Error inicializando dashboard:', error);
      window.location.href = '/auth.html';
    }
  }

  // ============================================================
  // FUNCI√ìN: Cargar perfil del usuario
  // ============================================================
  async function loadUserProfile(userId) {
    try {
      const response = await fetch(`/api/user-profile?userId=${userId}`);
      const data = await response.json();
      
      if (data.profile) {
        userProfile = data.profile;
        displayUserProfile();
      } else {
        console.log('No se encontr√≥ perfil, redirigiendo a wizard...');
        window.location.href = '/wizard.html';
      }
    } catch (error) {
      console.error('Error cargando perfil:', error);
    }
  }

  // ============================================================
  // FUNCI√ìN: Mostrar datos del perfil en el dashboard
  // ============================================================
  function displayUserProfile() {
    if (!userProfile) return;
    
    // Actualizar saludo
    const saludoElement = document.querySelector('h1, .greeting, [id*="saludo"]');
    if (saludoElement) {
      saludoElement.textContent = `Hola ${userProfile.nombre || 'Usuario'}! üëã`;
    }
    
    // Actualizar descripci√≥n de negocio
    const descripcionElement = document.querySelector('.tagline, .description, [id*="descripcion"]');
    if (descripcionElement) {
      descripcionElement.textContent = userProfile.tipo_negocio || 'Sistema comercial completo.';
    }
    
    // Actualizar m√©tricas del overview
    updateMetricas();
    
    // Actualizar "Tu Perfil"
    updatePerfilSection();
    
    // Actualizar nombre en header
    updateUserName();
  }

  // ============================================================
  // FUNCI√ìN: Actualizar m√©tricas del overview
  // ============================================================
  function updateMetricas() {
    // Objetivo Mensual
    const objetivoElement = document.getElementById('objetivo-mensual') || 
                            document.querySelector('[data-metric="objetivo"]');
    if (objetivoElement) {
      const objetivo = userProfile.objetivo_revenue_mensual || 0;
      objetivoElement.textContent = `$${objetivo.toLocaleString()}`;
    }
    
    // Revenue Actual
    const revenueElement = document.getElementById('revenue-actual') || 
                           document.querySelector('[data-metric="revenue"]');
    if (revenueElement) {
      revenueElement.textContent = `$0`;
    }
    
    // Tiempo Disponible
    const tiempoElement = document.getElementById('tiempo-disponible') || 
                          document.querySelector('[data-metric="tiempo"]');
    if (tiempoElement) {
      const horas = userProfile.horas_semana_ventas || 40;
      tiempoElement.textContent = `${horas}h/sem`;
    }
    
    // Leads Activos
    const leadsElement = document.getElementById('leads-activos') || 
                         document.querySelector('[data-metric="leads"]');
    if (leadsElement) {
      leadsElement.textContent = `0`;
    }
  }

  // ============================================================
  // FUNCI√ìN: Actualizar secci√≥n "Tu Perfil"
  // ============================================================
  function updatePerfilSection() {
  // Actualizar nombre
  const nombreEl = document.getElementById('perfil-nombre');
  if (nombreEl) {
    nombreEl.textContent = userProfile.nombre || '-';
  }
  
  // Actualizar negocio
  const negocioEl = document.getElementById('perfil-negocio');
  if (negocioEl) {
    negocioEl.textContent = userProfile.tipo_negocio || '-';
  }
  
  // Actualizar pa√≠s
  const paisEl = document.getElementById('perfil-pais');
  if (paisEl) {
    paisEl.textContent = userProfile.pais || '-';
  }
  
  // Actualizar objetivo
  const objetivoEl = document.getElementById('perfil-objetivo');
  if (objetivoEl) {
    const objetivo = userProfile.objetivo_revenue_mensual || 0;
    objetivoEl.textContent = objetivo.toLocaleString();
  }
  
  // Actualizar tiempo
  const tiempoEl = document.getElementById('perfil-tiempo');
  if (tiempoEl) {
    tiempoEl.textContent = userProfile.horas_semana_ventas || 0;
  }
}
  // ============================================================
  // FUNCI√ìN: Cargar contenido del dashboard seg√∫n tab activa
  // ============================================================
  function loadDashboardContent() {
    // Si hay funci√≥n cargarLeads y la tab Leads est√° activa, ejecutarla
    const leadsTab = document.querySelector('[data-tab="leads"], #leads-tab, .tab-leads');
    if (leadsTab && leadsTab.classList.contains('active') && typeof cargarLeads === 'function') {
      cargarLeads();
    }
  }

  // ============================================================
  // FUNCI√ìN: getUserId (helper mejorado)
  // ============================================================
  function getUserId() {
    // Prioridad 1: currentUser (ya verificado por autenticaci√≥n)
    if (currentUser) {
      return currentUser.id;
    }
    
    // Prioridad 2: localStorage directo
    let userId = localStorage.getItem('userId');
    if (userId) {
      return userId;
    }
    
    // Prioridad 3: sales_coach_state
    const state = localStorage.getItem('sales_coach_state');
    if (state) {
      try {
        const parsed = JSON.parse(state);
        userId = parsed.user_id;
        if (userId) return userId;
      } catch (e) {
        console.error('Error parsing sales_coach_state:', e);
      }
    }
    
    return null;
  }

  // ============================================================
  // FUNCI√ìN: Logout
  // ============================================================
  async function logout() {
    try {
      if (supabase) {
        await supabase.auth.signOut();
      }
    } catch (error) {
      console.error('Error al cerrar sesi√≥n:', error);
    }
    
    localStorage.clear();
    window.location.href = '/index.html';
  }

  // ============================================================
  // FUNCI√ìN: Cambiar entre tabs
  // ============================================================
  function showTab(tabName) {
    document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    
    const tabContent = document.getElementById(`tab-${tabName}`);
    if (tabContent) {
      tabContent.classList.add('active');
    }
    
    if (event && event.target) {
      event.target.classList.add('active');
    }
    
    if (tabName === 'coach') {
      console.log('Coach tab - funcionalidad pendiente');
    }
    
    if (tabName === 'leads' && typeof cargarLeads === 'function') {
      cargarLeads();
    }
    
    if (tabName === 'perfil' && typeof cargarDatosPersona === 'function') {
      cargarDatosPersona();
    }
  }

  // ============================================================
  // FUNCI√ìN: Actualizar nombre de usuario en header
  // ============================================================
  function updateUserName() {
    const userNameEl = document.getElementById('user-name');
    if (userNameEl && userProfile) {
      userNameEl.textContent = userProfile.nombre || 'Usuario';
    }
  }

  // ============================================================
  // INICIALIZAR AL CARGAR LA P√ÅGINA
  // ============================================================
  window.addEventListener('DOMContentLoaded', initDashboard);
</script>
  

  <!-- APPEND: JavaScript for Leads management -->
<script>
  // ============================================================
  // VARIABLES GLOBALES PARA LEADS
  // ============================================================
  let todosLosLeads = [];
  let filtroActual = 'todos';

  // ============================================================
  // CARGAR LEADS DESDE API
  // ============================================================
  async function cargarLeads() {
    try {
      const userId = getUserId();
      
      if (!userId) {
        console.log('No userId found');
        document.getElementById('leads-list-container').innerHTML = 
          '<p style="color: #999; text-align: center;">No se pudo cargar el usuario</p>';
        return;
      }
      
      const response = await fetch(`/api/contactos?userId=${encodeURIComponent(userId)}`);
      if (!response.ok) throw new Error('Error fetching contactos');
      const { contactos } = await response.json();
      
      todosLosLeads = contactos || [];
      mostrarLeads(todosLosLeads);
      
    } catch (error) {
      console.error('Error cargando leads:', error);
      const container = document.getElementById('leads-list-container');
      if (container) {
        container.innerHTML = 
          '<p style="color: #ef4444; text-align: center;">Error cargando leads</p>';
      }
    }
  }

  // ============================================================
  // MOSTRAR LEADS EN LA LISTA
  // ============================================================
  function mostrarLeads(leads) {
    const container = document.getElementById('leads-list-container');
    if (!container) return;
    
    if (!leads || leads.length === 0) {
      container.innerHTML = `
        <div style="text-align: center; padding: 40px;">
          <p style="font-size: 48px; margin-bottom: 10px;">üìã</p>
          <p style="color: #999; font-size: 18px;">No hay leads registrados</p>
          <button onclick="abrirModalAgregarLead()" style="margin-top: 20px; padding: 10px 20px; background: #10b981; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">
            + Agregar tu primer lead
          </button>
        </div>
      `;
      return;
    }
    
    const ahora = new Date();
    
    container.innerHTML = leads.map(lead => {
      const diasSinContacto = lead.ultima_interaccion 
        ? Math.floor((ahora - new Date(lead.ultima_interaccion)) / (1000 * 60 * 60 * 24))
        : '‚àû';
      
      const colores = {
        caliente: { border: '#ef4444', bg: '#fff8f8', emoji: 'üî•' },
        tibio: { border: '#f59e0b', bg: '#fffbf0', emoji: 'üå°Ô∏è' },
        frio: { border: '#3b82f6', bg: '#f0f9ff', emoji: '‚ùÑÔ∏è' }
      };
      
      const color = colores[lead.temperatura] || colores.frio;
      
      return `
        <div style="border-left: 4px solid ${color.border}; background: ${color.bg}; padding: 15px; margin-bottom: 12px; border-radius: 8px;">
          <div style="display: flex; justify-content: space-between; align-items: start; flex-wrap: wrap; gap: 10px;">
            
            <div style="flex: 1; min-width: 200px;">
              <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                <span style="font-size: 20px;">${color.emoji}</span>
                <strong style="font-size: 18px; color: #333;">${lead.nombre}</strong>
              </div>
              
              ${lead.empresa ? `<p style="color: #666; margin-bottom: 4px;">üè¢ ${lead.empresa}</p>` : ''}
              ${lead.telefono ? `<p style="color: #666; margin-bottom: 4px;">üìû ${lead.telefono}</p>` : ''}
              ${lead.email ? `<p style="color: #666; margin-bottom: 4px;">üìß ${lead.email}</p>` : ''}
              
              <p style="color: #999; font-size: 14px; margin-top: 8px;">
                √öltima interacci√≥n: ${diasSinContacto === '‚àû' ? 'Nunca' : `hace ${diasSinContacto} d√≠as`}
              </p>
              
              ${lead.notas ? `<p style="color: #666; font-size: 14px; margin-top: 8px; font-style: italic;">"${lead.notas}"</p>` : ''}
            </div>
            
            <div style="display: flex; gap: 8px; flex-wrap: wrap;">
              <button onclick="contactarLead('${lead.id}')" style="padding: 8px 16px; background: #10b981; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 600;">
                üìû Contactar
              </button>
              <button onclick="eliminarLead('${lead.id}')" style="padding: 8px 16px; background: #ef4444; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px; font-weight: 600;">
                üóëÔ∏è
              </button>
            </div>
            
          </div>
        </div>
      `;
    }).join('');
  }

  // ============================================================
  // FILTRAR LEADS
  // ============================================================
  function filtrarLeads(temperatura) {
    filtroActual = temperatura;
    
    document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
    const el = document.getElementById(`filter-${temperatura}`);
    if (el) el.classList.add('active');
    
    if (temperatura === 'todos') {
      mostrarLeads(todosLosLeads);
    } else {
      const leadsFiltrados = todosLosLeads.filter(lead => lead.temperatura === temperatura);
      mostrarLeads(leadsFiltrados);
    }
  }

  // ============================================================
  // MODAL AGREGAR LEAD
  // ============================================================
  function abrirModalAgregarLead() {
    const modal = document.getElementById('modal-agregar-lead');
    if (modal) {
      modal.style.display = 'flex';
      const form = document.getElementById('form-agregar-lead');
      if (form) form.reset();
    }
  }

  function cerrarModalAgregarLead() {
    const modal = document.getElementById('modal-agregar-lead');
    if (modal) modal.style.display = 'none';
  }

  // ============================================================
  // GUARDAR NUEVO LEAD
  // ============================================================
  async function guardarNuevoLead(event) {
    event.preventDefault();
    
    const userId = getUserId();
    
    if (!userId) {
      alert('Error: No se pudo identificar el usuario');
      return;
    }
    
    const nuevoLead = {
      user_id: userId,
      nombre: document.getElementById('lead-nombre').value,
      empresa: document.getElementById('lead-empresa').value || null,
      telefono: document.getElementById('lead-telefono').value || null,
      email: document.getElementById('lead-email').value || null,
      temperatura: document.getElementById('lead-temperatura').value,
      tipo: document.getElementById('lead-tipo').value,
      notas: document.getElementById('lead-notas').value || null
    };
    
    try {
      const response = await fetch('/api/contactos', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(nuevoLead)
      });
      
      if (!response.ok) throw new Error('Error al guardar');
      
      cerrarModalAgregarLead();
      await cargarLeads();
      alert('‚úÖ Lead agregado exitosamente');
      
    } catch (error) {
      console.error('Error guardando lead:', error);
      alert('‚ùå Error al guardar el lead');
    }
  }

  // ============================================================
  // CONTACTAR LEAD
  // ============================================================
  function contactarLead(leadId) {
    alert(`Contactar lead ${leadId}\n\nPr√≥ximamente:\n- Registrar llamada/email\n- Actualizar √∫ltima interacci√≥n\n- Agregar nota de seguimiento`);
  }

  // ============================================================
  // ELIMINAR LEAD
  // ============================================================
  async function eliminarLead(leadId) {
    if (!confirm('¬øEst√°s seguro de eliminar este lead?')) return;
    
    try {
      const response = await fetch(`/api/contactos?id=${encodeURIComponent(leadId)}`, {
        method: 'DELETE'
      });
      
      if (!response.ok) throw new Error('Error al eliminar');
      
      await cargarLeads();
      alert('‚úÖ Lead eliminado');
      
    } catch (error) {
      console.error('Error eliminando lead:', error);
      alert('‚ùå Error al eliminar el lead');
    }
  }

  // ============================================================
  // INICIALIZAR CUANDO SE MUESTRA LA TAB LEADS
  // ============================================================
  // Llamar cargarLeads() cuando se active la tab Leads en tu sistema de tabs.
  // Si tienes una funci√≥n showTab(tabId) agrega: if(tabId==='leads'){ cargarLeads(); }
  // Si la tab Leads se muestra por defecto, invoca cargarLeads() aqu√≠:
  // cargarLeads();
</script>
<!-- END APPEND -->

  <!-- APPEND: JavaScript for Mi Perfil -->
<script>
  // ============================================================
  // CAMBIAR NOMBRE A CONTACTOS
  // ============================================================
  document.querySelectorAll('.tab').forEach(t => {
    if (t.textContent.includes('Leads')) {
      t.innerHTML = t.innerHTML.replace('Leads', 'Contactos');
    }
  });
  
  // ============================================================
  // FUNCI√ìN: Cambiar secci√≥n dentro de Mi Perfil
  // ============================================================
  function showPerfilSection(sectionName) {
    document.querySelectorAll('.perfil-section').forEach(s => s.classList.remove('active'));
    document.querySelectorAll('.perfil-nav-item').forEach(n => n.classList.remove('active'));
    
    const section = document.getElementById(`perfil-${sectionName}`);
    if (section) {
      section.classList.add('active');
    }
    
    if (event && event.target) {
      event.target.classList.add('active');
    }
    
    if (sectionName === 'persona') {
      cargarDatosPersona();
    } else if (sectionName === 'timeline') {
      cargarTimeline();
    } else if (sectionName === 'negocio') {
      cargarServicios();
    }
  }

  // ============================================================
  // FUNCI√ìN: Cargar datos de persona desde userProfile
  // ============================================================
  function cargarDatosPersona() {
    if (!userProfile) return;
    
    // Identidad
    if (userProfile.nombre) document.getElementById('persona-nombre').value = userProfile.nombre;
    if (userProfile.edad) document.getElementById('persona-edad').value = userProfile.edad;
    if (userProfile.background) document.getElementById('persona-background').value = userProfile.background;
    if (userProfile.situacion_familiar) document.getElementById('persona-situacion-familiar').value = userProfile.situacion_familiar;
    if (userProfile.presion_financiera) document.getElementById('persona-presion-financiera').value = userProfile.presion_financiera;
    if (userProfile.otros_compromisos) document.getElementById('persona-otros-compromisos').value = userProfile.otros_compromisos;
    
    // Visi√≥n
    if (userProfile.vision_1_year) document.getElementById('persona-vision-1').value = userProfile.vision_1_year;
    if (userProfile.vision_3_years) document.getElementById('persona-vision-3').value = userProfile.vision_3_years;
    if (userProfile.vision_5_years) document.getElementById('persona-vision-5').value = userProfile.vision_5_years;
    if (userProfile.proposito) document.getElementById('persona-proposito').value = userProfile.proposito;
    if (userProfile.definicion_exito) document.getElementById('persona-exito').value = userProfile.definicion_exito;
    
    // FODA
    if (userProfile.foda) {
      if (userProfile.foda.fortalezas) {
        document.getElementById('persona-fortalezas').value = userProfile.foda.fortalezas.join('\n');
      }
      if (userProfile.foda.oportunidades) {
        document.getElementById('persona-oportunidades').value = userProfile.foda.oportunidades.join('\n');
      }
      if (userProfile.foda.debilidades) {
        document.getElementById('persona-debilidades').value = userProfile.foda.debilidades.join('\n');
      }
      if (userProfile.foda.amenazas) {
        document.getElementById('persona-amenazas').value = userProfile.foda.amenazas.join('\n');
      }
    }
  }

  // ============================================================
  // FUNCI√ìN: Guardar cambios de persona
  // ============================================================
  async function guardarPersona() {
    const userId = getUserId();
    if (!userId) {
      alert('Error: No se pudo identificar el usuario');
      return;
    }
    
    // Recopilar datos del formulario
    const datosPersona = {
      nombre: document.getElementById('persona-nombre').value || null,
      edad: parseInt(document.getElementById('persona-edad').value) || null,
      background: document.getElementById('persona-background').value || null,
      situacion_familiar: document.getElementById('persona-situacion-familiar').value || null,
      presion_financiera: document.getElementById('persona-presion-financiera').value || null,
      otros_compromisos: document.getElementById('persona-otros-compromisos').value || null,
      
      vision_1_year: document.getElementById('persona-vision-1').value || null,
      vision_3_years: document.getElementById('persona-vision-3').value || null,
      vision_5_years: document.getElementById('persona-vision-5').value || null,
      proposito: document.getElementById('persona-proposito').value || null,
      definicion_exito: document.getElementById('persona-exito').value || null,
      
      foda: {
        fortalezas: document.getElementById('persona-fortalezas').value.split('\n').filter(l => l.trim()),
        oportunidades: document.getElementById('persona-oportunidades').value.split('\n').filter(l => l.trim()),
        debilidades: document.getElementById('persona-debilidades').value.split('\n').filter(l => l.trim()),
        amenazas: document.getElementById('persona-amenazas').value.split('\n').filter(l => l.trim())
      }
    };
    
    try {
      const response = await fetch('/api/user-profile', {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ userId, updates: datosPersona })
      });
      
      if (!response.ok) throw new Error('Error al guardar');
      
      // Actualizar userProfile en memoria
      userProfile = { ...userProfile, ...datosPersona };
      
      alert('‚úÖ Cambios guardados exitosamente');
      
    } catch (error) {
      console.error('Error guardando persona:', error);
      alert('‚ùå Error al guardar cambios');
    }
  }

  // ============================================================
  // FUNCI√ìN: Cargar timeline de cambios
  // ============================================================
  async function cargarTimeline() {
    const userId = getUserId();
    if (!userId) return;
    
    const container = document.getElementById('timeline-container');
    container.innerHTML = '<p style="text-align: center; color: #999;">Cargando historial...</p>';
    
    try {
      // TODO: Crear endpoint /api/profile-timeline
      container.innerHTML = '<p style="text-align: center; color: #999;">Timeline pr√≥ximamente...</p>';
    } catch (error) {
      console.error('Error cargando timeline:', error);
      container.innerHTML = '<p style="text-align: center; color: #ef4444;">Error cargando historial</p>';
    }
  }

  // ============================================================
  // INICIALIZAR AL CARGAR LA P√ÅGINA
  // ============================================================
  window.addEventListener('DOMContentLoaded', () => {
    initDashboard();
    
    // Forzar carga de perfil al iniciar
    setTimeout(() => {
      if (currentUser) {
        loadUserProfile(currentUser.id);
      }
    }, 1000);
  });
</script>
<!-- END APPEND -->

<!-- TAB: Mi Perfil -->
    <div id="tab-perfil" class="tab-content">
      <div class="perfil-container">
        
        <!-- Sidebar de navegaci√≥n -->
        <div class="perfil-sidebar">
          <h3 style="padding: 20px; margin: 0; color: #667eea;">Mi Perfil</h3>
          
          <div class="perfil-nav">
            <button class="perfil-nav-item active" onclick="showPerfilSection('persona')">
              üë§ Persona
            </button>
            <button class="perfil-nav-item" onclick="showPerfilSection('negocio')">
              üíº Negocio
            </button>
            <button class="perfil-nav-item" onclick="showPerfilSection('timeline')">
              üìä Mi Evoluci√≥n
            </button>
          </div>
        </div>
        
        <!-- Contenido principal -->
        <div class="perfil-content">
          
          <!-- SECCI√ìN: PERSONA -->
          <div id="perfil-persona" class="perfil-section active">
            <h2>üë§ Persona</h2>
            <p style="color: #666; margin-bottom: 30px;">
              Ayudanos a conocerte mejor para darte recomendaciones m√°s personalizadas.
            </p>
            
            <!-- Subsecci√≥n: Identidad -->
            <div class="perfil-card">
              <h3>Identidad & Background</h3>
              <div class="form-grid">
                <div>
                  <label>Nombre</label>
                  <input type="text" id="persona-nombre" value="" placeholder="Tu nombre">
                </div>
                <div>
                  <label>Edad</label>
                  <input type="number" id="persona-edad" placeholder="Ej: 31">
                </div>
                <div style="grid-column: 1 / -1;">
                  <label>Background Profesional</label>
                  <textarea id="persona-background" rows="3" placeholder="Ej: Ingeniero en sistemas con 12 a√±os de experiencia, ahora emprendedor..."></textarea>
                </div>
                <div>
                  <label>Situaci√≥n Familiar</label>
                  <input type="text" id="persona-situacion-familiar" placeholder="Ej: Casado, 2 hijos">
                </div>
                <div>
                  <label>Presi√≥n Financiera</label>
                  <select id="persona-presion-financiera">
                    <option value="">Seleccionar...</option>
                    <option value="baja">Baja</option>
                    <option value="media">Media</option>
                    <option value="alta">Alta</option>
                  </select>
                </div>
                <div style="grid-column: 1 / -1;">
                  <label>Otros Compromisos</label>
                  <input type="text" id="persona-otros-compromisos" placeholder="Ej: Podcast semanal, mentor en startup...">
                </div>
              </div>
            </div>
            
            <!-- Subsecci√≥n: Visi√≥n -->
            <div class="perfil-card">
              <h3>Visi√≥n & Prop√≥sito</h3>
              <div class="form-grid">
                <div style="grid-column: 1 / -1;">
                  <label>Visi√≥n a 1 a√±o</label>
                  <textarea id="persona-vision-1" rows="2" placeholder="¬øD√≥nde te ves en 1 a√±o?"></textarea>
                </div>
                <div style="grid-column: 1 / -1;">
                  <label>Visi√≥n a 3 a√±os</label>
                  <textarea id="persona-vision-3" rows="2" placeholder="¬øD√≥nde te ves en 3 a√±os?"></textarea>
                </div>
                <div style="grid-column: 1 / -1;">
                  <label>Visi√≥n a 5 a√±os</label>
                  <textarea id="persona-vision-5" rows="2" placeholder="¬øD√≥nde te ves en 5 a√±os?"></textarea>
                </div>
                <div style="grid-column: 1 / -1;">
                  <label>Tu Prop√≥sito (¬øPor qu√© hac√©s lo que hac√©s?)</label>
                  <textarea id="persona-proposito" rows="2" placeholder="Ej: Ayudar a emprendedores a escalar sus negocios con IA..."></textarea>
                </div>
                <div style="grid-column: 1 / -1;">
                  <label>Definici√≥n de √âxito Personal</label>
                  <textarea id="persona-exito" rows="2" placeholder="¬øQu√© significa √©xito para vos?"></textarea>
                </div>
              </div>
            </div>
            
            <!-- Subsecci√≥n: FODA -->
            <div class="perfil-card">
              <h3>FODA Personal</h3>
              <div class="form-grid">
                <div style="grid-column: 1 / -1;">
                  <label>üí™ Fortalezas (una por l√≠nea)</label>
                  <textarea id="persona-fortalezas" rows="4" placeholder="Ej:&#10;Experiencia t√©cnica profunda&#10;Red de contactos en LatAm&#10;Comunicaci√≥n clara"></textarea>
                </div>
                <div style="grid-column: 1 / -1;">
                  <label>üöÄ Oportunidades (una por l√≠nea)</label>
                  <textarea id="persona-oportunidades" rows="4" placeholder="Ej:&#10;Mercado de IA en crecimiento&#10;Alianzas con agencias&#10;Expansi√≥n a otros pa√≠ses"></textarea>
                </div>
                <div style="grid-column: 1 / -1;">
                  <label>‚ö†Ô∏è Debilidades (una por l√≠nea)</label>
                  <textarea id="persona-debilidades" rows="4" placeholder="Ej:&#10;Impaciencia con procesos lentos&#10;Falta de equipo comercial&#10;Poca visibilidad online"></textarea>
                </div>
                <div style="grid-column: 1 / -1;">
                  <label>üõë Amenazas (una por l√≠nea)</label>
                  <textarea id="persona-amenazas" rows="4" placeholder="Ej:&#10;Competidores con m√°s capital&#10;Cambios regulatorios IA&#10;Saturaci√≥n de mercado"></textarea>
                </div>
              </div>
            </div>
            
            <button onclick="guardarPersona()" class="btn-save">
              üíæ Guardar Cambios
            </button>
          </div>
          
          <!-- SECCI√ìN: NEGOCIO -->
          <div id="perfil-negocio" class="perfil-section">
            <h2>üíº Negocio</h2>
            <p style="color: #666; margin-bottom: 30px;">
              Configur√° tu cat√°logo de servicios, ICPs y objetivos comerciales.
            </p>
            
            <!-- Subsecciones de Negocio -->
            <div class="negocio-tabs">
              <button class="negocio-tab-btn active" onclick="showNegocioTab('servicios')">
                üì¶ Servicios
              </button>
              <button class="negocio-tab-btn" onclick="showNegocioTab('icps')">
                üéØ ICPs
              </button>
              <button class="negocio-tab-btn" onclick="showNegocioTab('objetivos')">
                üìä Objetivos
              </button>
            </div>
            
            <!-- TAB: Servicios -->
            <div id="negocio-servicios" class="negocio-tab-content active">
              
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 style="margin: 0;">Mis Servicios</h3>
                <button onclick="abrirModalServicio()" style="padding: 10px 20px; background: #10b981; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">
                  + Agregar Servicio
                </button>
              </div>
              
              <div id="servicios-list-container">
                <p style="text-align: center; color: #999;">Cargando servicios...</p>
              </div>
              
            </div>
            
            <!-- TAB: ICPs -->
            <div id="negocio-icps" class="negocio-tab-content">
              <h3>ICPs (Ideal Customer Profiles)</h3>
              <p style="color: #999; margin-top: 20px;">Pr√≥ximamente...</p>
            </div>
            
            <!-- TAB: Objetivos -->
            <div id="negocio-objetivos" class="negocio-tab-content">
              <h3>Objetivos Comerciales</h3>
              <p style="color: #999; margin-top: 20px;">Pr√≥ximamente...</p>
            </div>
            
          </div>
          
          <!-- SECCI√ìN: TIMELINE -->
          <div id="perfil-timeline" class="perfil-section">
            <h2>üìä Mi Evoluci√≥n</h2>
            <p style="color: #666; margin-bottom: 30px;">
              Timeline de cambios en desarrollo...
            </p>
            <div id="timeline-container">
              <p style="text-align: center; color: #999;">Cargando historial...</p>
            </div>
          </div>
          
        </div>
        
      </div>
    </div>
    <!-- END TAB: Mi Perfil -->

  <!-- Scripts -->
  <script>
    // ...existing init code...

    // ...existing functions (showTab, getUserId, logout, etc)...

  </script>

  <!-- ...existing Leads script... -->

  <!-- APPEND: JavaScript for Services management -->
<script>
  // ============================================================
  // FUNCI√ìN: Cambiar tab dentro de Negocio
  // ============================================================
  function showNegocioTab(tabName) {
    document.querySelectorAll('.negocio-tab-content').forEach(t => t.classList.remove('active'));
    document.querySelectorAll('.negocio-tab-btn').forEach(b => b.classList.remove('active'));
    
    const tab = document.getElementById(`negocio-${tabName}`);
    if (tab) tab.classList.add('active');
    
    if (event && event.target) {
      event.target.classList.add('active');
    }
    
    if (tabName === 'servicios') {
      cargarServicios();
    }
  }

  // ============================================================
  // FUNCI√ìN: Cargar servicios desde API
  // ============================================================
  async function cargarServicios() {
    const userId = getUserId();
    if (!userId) return;
    
    const container = document.getElementById('servicios-list-container');
    container.innerHTML = '<p style="text-align: center; color: #999;">Cargando servicios...</p>';
    
    try {
      const response = await fetch(`/api/servicios?userId=${encodeURIComponent(userId)}&includeInactive=true`);
      const { servicios } = await response.json();
      
      mostrarServicios(servicios);
      
    } catch (error) {
      console.error('Error cargando servicios:', error);
      container.innerHTML = '<p style="text-align: center; color: #ef4444;">Error cargando servicios</p>';
    }
  }

  // ============================================================
  // FUNCI√ìN: Mostrar servicios en la lista
  // ============================================================
  function mostrarServicios(servicios) {
    const container = document.getElementById('servicios-list-container');
    
    if (!servicios || servicios.length === 0) {
      container.innerHTML = `
        <div style="text-align: center; padding: 60px 20px;">
          <p style="font-size: 48px; margin-bottom: 10px;">üì¶</p>
          <p style="color: #999; font-size: 18px; margin-bottom: 20px;">No ten√©s servicios configurados</p>
          <button onclick="abrirModalServicio()" style="padding: 10px 24px; background: #10b981; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">
            + Agregar tu primer servicio
          </button>
        </div>
      `;
      return;
    }
    
    container.innerHTML = servicios.map(servicio => {
      const categoriaEmoji = {
        'consultor√≠a': 'üìã',
        'taller': 'üéì',
        'producto': 'üì¶',
        'agente_ia': 'ü§ñ',
        'implementaci√≥n': '‚öôÔ∏è',
        'otro': 'üíº'
      };
      
      const emoji = categoriaEmoji[servicio.categoria] || 'üíº';
      const inactiveClass = servicio.activo ? '' : 'inactive';
      
      return `
        <div class="servicio-card ${inactiveClass}">
          <div class="servicio-header">
            <div style="flex: 1;">
              <div class="servicio-title">
                ${emoji} ${servicio.nombre}
                ${servicio.categoria ? `<span class="servicio-categoria">${servicio.categoria}</span>` : ''}
                ${!servicio.activo ? '<span style="color: #ef4444; font-size: 14px; margin-left: 10px;">(Inactivo)</span>' : ''}
              </div>
              ${servicio.descripcion ? `<p class="servicio-info">${servicio.descripcion}</p>` : ''}
              <div class="servicio-info">
                ${servicio.precio_base ? `üí∞ $${servicio.precio_base.toLocaleString()}` : ''}
                ${servicio.duracion ? ` ‚Ä¢ ‚è±Ô∏è ${servicio.duracion}` : ''}
                ${servicio.tipo_facturacion ? ` ‚Ä¢ üìÖ ${servicio.tipo_facturacion}` : ''}
              </div>
            </div>
            <div class="servicio-actions">
              <button onclick="editarServicio('${servicio.id}')" class="btn-icon btn-edit">
                ‚úèÔ∏è Editar
              </button>
              <button onclick="toggleServicio('${servicio.id}', ${!servicio.activo})" class="btn-icon btn-toggle">
                ${servicio.activo ? '‚è∏Ô∏è Desactivar' : '‚ñ∂Ô∏è Activar'}
              </button>
              <button onclick="eliminarServicio('${servicio.id}')" class="btn-icon btn-delete">
                üóëÔ∏è
              </button>
            </div>
          </div>
        </div>
      `;
    }).join('');
  }

  // ============================================================
  // FUNCI√ìN: Abrir modal servicio
  // ============================================================
  function abrirModalServicio(servicioData = null) {
    const modal = document.getElementById('modal-servicio');
    const title = document.getElementById('modal-servicio-title');
    const form = document.getElementById('form-servicio');
    
    form.reset();
    document.getElementById('servicio-id').value = '';
    
    if (servicioData) {
      title.textContent = 'Editar Servicio';
      document.getElementById('servicio-id').value = servicioData.id;
      document.getElementById('servicio-nombre').value = servicioData.nombre || '';
      document.getElementById('servicio-descripcion').value = servicioData.descripcion || '';
      document.getElementById('servicio-categoria').value = servicioData.categoria || '';
      document.getElementById('servicio-precio-base').value = servicioData.precio_base || '';
      document.getElementById('servicio-precio-minimo').value = servicioData.precio_minimo || '';
      document.getElementById('servicio-precio-maximo').value = servicioData.precio_maximo || '';
      document.getElementById('servicio-duracion').value = servicioData.duracion || '';
      document.getElementById('servicio-tipo-facturacion').value = servicioData.tipo_facturacion || '';
    } else {
      title.textContent = 'Agregar Servicio';
    }
    
    modal.style.display = 'flex';
  }

  function cerrarModalServicio() {
    document.getElementById('modal-servicio').style.display = 'none';
  }

  // ============================================================
  // FUNCI√ìN: Guardar servicio
  // ============================================================
  async function guardarServicio(event) {
    event.preventDefault();
    
    const userId = getUserId();
    if (!userId) {
      alert('Error: No se pudo identificar el usuario');
      return;
    }
    
    const id = document.getElementById('servicio-id').value;
    const isEditing = !!id;
    
    const servicioData = {
      nombre: document.getElementById('servicio-nombre').value,
      descripcion: document.getElementById('servicio-descripcion').value || null,
      categoria: document.getElementById('servicio-categoria').value || null,
      precio_base: parseFloat(document.getElementById('servicio-precio-base').value) || null,
      precio_minimo: parseFloat(document.getElementById('servicio-precio-minimo').value) || null,
      precio_maximo: parseFloat(document.getElementById('servicio-precio-maximo').value) || null,
      duracion: document.getElementById('servicio-duracion').value || null,
      tipo_facturacion: document.getElementById('servicio-tipo-facturacion').value || null
    };
    
    if (isEditing) {
      servicioData.id = id;
    } else {
      servicioData.user_id = userId;
      servicioData.activo = true;
    }
    
    try {
      const response = await fetch('/api/servicios', {
        method: isEditing ? 'PUT' : 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(servicioData)
      });
      
      if (!response.ok) throw new Error('Error al guardar');
      
      cerrarModalServicio();
      await cargarServicios();
      alert(`‚úÖ Servicio ${isEditing ? 'actualizado' : 'creado'} exitosamente`);
      
    } catch (error) {
      console.error('Error guardando servicio:', error);
      alert('‚ùå Error al guardar el servicio');
    }
  }

  // ============================================================
  // FUNCI√ìN: Editar servicio
  // ============================================================
  async function editarServicio(servicioId) {
    const userId = getUserId();
    if (!userId) return;
    
    try {
      const response = await fetch(`/api/servicios?userId=${userId}&includeInactive=true`);
      const { servicios } = await response.json();
      
      const servicio = servicios.find(s => s.id === servicioId);
      if (servicio) {
        abrirModalServicio(servicio);
      }
    } catch (error) {
      console.error('Error cargando servicio:', error);
    }
  }

  // ============================================================
  // FUNCI√ìN: Toggle servicio
  // ============================================================
  async function toggleServicio(servicioId, activar) {
    try {
      const response = await fetch('/api/servicios', {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ 
          id: servicioId, 
          activo: activar 
        })
      });
      
      if (!response.ok) throw new Error('Error al actualizar');
      
      await cargarServicios();
      
    } catch (error) {
      console.error('Error toggle servicio:', error);
      alert('‚ùå Error al actualizar el servicio');
    }
  }

  // ============================================================
  // FUNCI√ìN: Eliminar servicio
  // ============================================================
  async function eliminarServicio(servicioId) {
    if (!confirm('¬øEst√°s seguro de eliminar este servicio? Esta acci√≥n no se puede deshacer.')) {
      return;
    }
    
    try {
      const response = await fetch(`/api/servicios?id=${encodeURIComponent(servicioId)}`, {
        method: 'DELETE'
      });
      
      if (!response.ok) throw new Error('Error al eliminar');
      
      await cargarServicios();
      alert('‚úÖ Servicio eliminado');
      
    } catch (error) {
      console.error('Error eliminando servicio:', error);
      alert('‚ùå Error al eliminar el servicio');
    }
  }
</script>
<!-- END APPEND -->

</body>
</html>
